# 为什么要微服务？
随着业务的发展，一体化架构在技术和管理上都会面临很多挑战，微服务就是为了更好地解决这些问题。

# 微服务化时的几点建议
- 服务内高内聚，服务间低耦合
- 服务拆分粒度可以先粗一些，后面再细化
- 逐步拆分，先拆分比较独立的非核心服务，先拆分更被依赖的服务

# 微服务带来的挑战
- 服务治理
- 服务故障
- 服务监控和分布式追踪工具

# RPC框架
RPC框架封装了网络调用的细节，让你像调用本地服务一样调用远程服务。

![RPC调用过程示意图](https://static001.geekbang.org/resource/image/f9/3e/f98bd80af8a4e7258251db1084e0383e.jpg)

要想保证RPC框架的性能，可以从网络传输和序列化两方面来考虑。

网络传输：
- 选择高性能的I/O模型
- 调试网络参数，比如开启tcp_nodelay

序列化：
- 时间效率和空间效率
- 是否支持跨语言、跨平台

如果对于性能要求不高，可以使用JSON；如果对于性能要求较高，可以使用Thrift或Protobuf.

# 注册中心
![注册中心示意图](https://static001.geekbang.org/resource/image/3e/13/3ee52d302f77bf5e61b244094d754d13.jpg)

有了注册中心之后，服务节点的变更对客户端就是透明的，方便我们动态地变更服务节点，实现graceful shutdown等功能。

服务节点探活有两种方式：
- 注册中心主动探测
- 服务节点心跳机制

主动探测不方便、成本高，一般的，我们使用心跳机制。
![心跳机制示意图](https://static001.geekbang.org/resource/image/76/99/768494782e63e9dcddd464cb6bdd7e99.jpg)