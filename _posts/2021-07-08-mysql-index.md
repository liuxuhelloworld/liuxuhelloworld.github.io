# 索引数据模型
提高查询效率的数据结构有很多，常见的有：
- 哈希表：哈希表适用于只有等值查询的场景，区间查询很慢
- 有序数组：有序数组做等值查询和区间查询都很快，但是插入记录的成本很高，适用于静态存储
- 搜索树：使用N叉树而不是简单地使用二叉树是为了减少读写磁盘的次数。以 InnoDB 的一个整数字段索引为例，这个 N 差不多是 1200。这棵树高是 4 的时候，就可以存 1200 的 3 次方个值，这已经 17 亿了。考虑到树根的数据块总是在内存中的，一个 10 亿行的表上一个整数字段的索引，查找一个值最多只需要访问 3 次磁盘。其实，树的第二层也有很大概率在内存中，那么访问磁盘的平均次数就更少了

# InnoDB索引
MySQL索引是在存储引擎层实现的。

InnoDB的表都是根据主键以索引的形式存放的，这种存储方式称为索引组织表。

InnoDB使用B+树维护索引，每一个索引在InnoDB中对应一颗B+树。

根据叶子节点的内容，可以分为：
- 主键索引：主键索引叶子节点存储的是整行数据，主键索引也称为聚簇索引，根据主键索引查询只需要搜索一颗B+树
- 非主键索引：非主键索引叶子节点存储的是主键值，非主键索引也称为二级索引，根据非主键索引查询需要搜索两颗B+树，即需要回表

插入数据时需要做一些操作来维护B+树，可能涉及页分裂和页合并。

某些建表规范要求使用自增主键，为什么？
- 使用自增主键的好处是每次都是追加操作，不会触发叶子节点的分裂，如果使用业务字段做主键，不容易保证有序插入，写数据的成本就会大一些
- 非主键索引的叶子节点存储的是主键值，使用自增主键占用的空间小
- 因此，从时间和空间两方面的效率来看，使用自增主键一般都是更好的选择

有没有场景适合用业务字段做主键，而不使用自增主键呢？有的，如果你的业务场景只有一个索引，并且是唯一索引，那么也可以使用业务字段做主键。

什么情况下需要重建索引？索引可能因为删除，或者页分裂等原因，导致数据页有空洞，重建索引的过程会把数据按顺序插入，这样页面的利用率更高，也就是索引更紧凑、更省空间。

# 覆盖索引
如果根据某个索引查询时不需要回表，这个索引就称为覆盖索引，覆盖索引是一种常用的优化手段。

比如，公民信息表，以身份证号做了索引，还有必要以身份证号+名字做联合索引吗？如果根据身份证号查询名字是高频的，那么以身份证号+名字做联合索引是合适的，这样就用到了覆盖索引，而无需回表。

# 最左前缀原则
B+树结构的索引，可以利用索引的“最左前缀”来定位记录。只要满足最左前缀，就可以用到索引来加速查询，这个最左前缀可以是联合索引的最左N个字段，也可以是字符串索引的最左N个字符。

在建立联合索引的时候，如何安排索引内的字段顺序呢？
- 一个原则是，如果通过调整顺序，可以少维护一个索引，那么这个顺序往往是需要优先考虑采用的。比如，已经有了(a,b)的联合索引，一般就不需要单独在a上建立索引了
- 那么如果需要单独查b呢？查询条件里只有b的语句，是无法使用(a,b)这个联合索引的，此时就不得不为b单独再建一个索引
- 如果既有a和b的联合查询，又有分别查询a或b，那么应当考虑将占用空间更小的建立单独索引

# 索引下推
MySQL 5.6引入，可以在索引遍历过程中，对索引中包含的字段先做判断，不满足查询条件的直接过滤，减少回表次数。